<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socket.IO Video chat</title>

    <script src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.js"></script>
    <script src="//cdn.bootcdn.net/ajax/libs/socket.io/3.0.4/socket.io.js"></script>
</head>
<body>
    <!-- video元素 -->
    <video autoplay controls id="video-local"></video>

    <script>
        // 封装一部分函数
        function getUserMedia(constrains, success,error){
            let promise;
            if (navigator.mediaDevices.getUserMedia){
                //最新标准API
                promise = navigator.mediaDevices.getUserMedia(constrains).then(success).catch(error);
            }else if(navigator.webkitGetUserMedia){
                //webkit内核浏览器
                promise = navigator.webkitGetUserMedia(constrains).then(success).catch(error);
            }else if(navigator.mozGetUserMedia){
                //Firefox浏览器
                promise = navigator.mozGetUserMedia(constrains).then(success).catch(error);
            }else if(navigator.getUserMedia){
                //旧版API
                promise = navigator.getUserMedia(constrains).then(success).catch(error);
            }
            return promise;
        }
        function canGetUserMediaUse(){
            return !!(navigator.mediaDevices.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia);
        }
        const localVideoElm = document.getElementById('video-local');
        $(document).ready(function(){
            if(canGetUserMediaUse()){
                getUserMedia({
                    video:true, //是否需要打开视频图像
                    audio:false //是否需要音频
                },(stream) => {
                    localVideoElm.srcObject = stream;
                    $(localVideoElm).width(800);
                },(err) => {
                    console.log("访问用户媒体设备失败：", err.name, err.message);
                })
            }else{
                alert('你的浏览器不兼容，建议安装最新版Chrome')
            }
        })
    </script>
</body>
</html>